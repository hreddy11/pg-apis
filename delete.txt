from google.auth import default
from google.auth.transport.requests import Request
from google.cloud import composer_v1beta1
from google.oauth2 import service_account

# Replace these variables with your actual values
project_id = 'your-project-id'
location = 'your-composer-location'
composer_environment = 'your-composer-environment'
dag_name = 'your-dag-name'

# Authenticate using service account credentials
credentials = service_account.Credentials.from_service_account_file(
    'path/to/your/service-account-key.json'
)

# Create the client for Cloud Composer
client_options = {'api_endpoint': f'{location}-composer.googleapis.com'}
client = composer_v1beta1.EnvironmentsClient(credentials=credentials, client_options=client_options)

# Trigger the DAG
dag_run = client.create_dag_run(
    parent=f'projects/{project_id}/locations/{location}/environments/{composer_environment}',
    dag_run={'dag_name': dag_name}
)

print(f'DAG run {dag_run.name} created.')
